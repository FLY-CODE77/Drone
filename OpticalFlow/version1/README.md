# OPTICAL FLOW

> 광학흐름
- 광학 흐름이란 영상 내 물체의 움직임 패턴을 의미합니다.
- 광학 흐름으로 영상 내 물체가 어느 방향으로 얼마만큼 움직였는지 파악할수 있고 
- 추가 연산시 물체의 움직임도 예측 가능합니다

> 광학흐름은 두가지 사실을 가정합니다
- 연속된 프레임 사이에서 움직이는 물체의 픽셀 intensity는 변함이 없다.
- 이웃하는 픽셀은 비슷한 움직임을 가진다.

---
- Pixel intensity란?
    - pixel intensity는 특정 화소의 밝은 정도를 나타냅니다.
---

> 광학 흐름 계산 방법은 두가지입니다
- 일부 픽셀만 계산하는 희소(sparse) 광학 흐름
- 영상 전체 픽셀을 모두 계산하는 밀집(dense) 광학 흐름

## Lucas-kanade algorism
- 이웃하는 픽셀은 비슷한 움직임을 가진다고 가정하고, 광학 흐름을 파악합니다.
- lucas-kanade 알고리즘은 작은 윈도를 사용해 움직임을 계산합니다.
- 큰 움직임이 생기면 문제가 생기는데, 윈도우가 작기 때문입니다.
- 큰 움직임도 사용하기 위해 이미지 파라미드를 사용하는데,
- 이미지 파라미드는 위쪽으로 가면(이미지가 작아지면..)
- 작은 움직임은 티가 안 나고, 큰 움직임은 작은 움직임으로 보여, 큰 움직임을 detected 할 수 있습니다.


## Gunner Farneback algorism
- 밀집 방식으로 광학 흐름을 계산하는 알고리즘 입니다
- 밀집 방식은 영상 전체의 픽셀을 활용해 광학 흐름을 계산하는 방식입니다


## version_1 결과
#### Lucas-kanade 방식
![Screenshot from 2021-05-06 17-12-53](https://user-images.githubusercontent.com/72845895/117264614-5afc3800-ae8e-11eb-845a-e2c874a70329.png)
- 속도도 상대적으로 빠르고, 드론의 움직임이 잘 잡힙니다.
- 다만 로터부분에서 코너점이 위주로 잡혀서 트레킹 됩니다.

#### Gunner 방식
![Screenshot from 2021-05-06 17-12-04](https://user-images.githubusercontent.com/72845895/117264709-723b2580-ae8e-11eb-84db-6ecbc7ec47e1.png)
- 전체 픽샐 단위로 움직이니... 드론 움직임이 잘 표현이 안됩니다.

### version upgrade하면서 추가해야 할 것
- 드론 몸체에 코너점을 잡아서 움직이고 싶고,
- 드론에만 집중시키고 싶습니다
- 움직임 예상도 추가하고 싶습니다.

#### FIN